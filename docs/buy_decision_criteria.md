# 매수 판단 기준 문서

> 최종 업데이트: 2026-02-18

이 프로젝트의 매수 판단은 **두 가지 독립적인 전략**으로 구성됩니다.

---

## 전략 1: 알고리즘 기반 — 급등주 모멘텀 단타

**파일**: `src/trading/momentum.py`  
**함수**: `check_momentum_and_scalp()`  
**실행 주기**: 장중 주기적 호출 (09:00 ~ 15:00)

### 매수 조건 (AND 조건)

| 조건 | 기준 |
|------|------|
| 등락률 | **5.0% 이상 ~ 20.0% 이하** (상한가 근처 제외) |
| 거래량 | **10만 주 이상** (거래량 동반 확인) |
| 중복 방지 | **당일 이미 매수한 종목 제외** |

- 조건을 만족하는 첫 번째 종목 1개만 매수
- 데이터 소스: KIS API `get_rank_rising()` (급등 랭킹)

### 매수 금액

- `RISK_CONFIG["scalping_amount"]` 고정 금액 (기본값 설정 파일 참조)
- 수량 = `scalping_amount / 현재가` (소수점 버림)
- 주문 방식: **시장가**

### 매도 조건

- `sell_all_scalps()`: **장 마감 전 일괄 청산** (당일 진입 포지션 전량)
- 익절/손절 기준 없음 — 무조건 당일 청산

---

## 전략 2: LLM 기반 — 일일 추천 매수

### 2-A. 아침 루틴 (한국장)

**파일**: `src/scheduler/routines.py` → `run_morning_routine()`  
**실행 시각**: 08:00 루틴 실행 → **09:00 매수 주문**

#### 추천 생성

- `get_daily_recommendations(market_data, news_data, market="KR")`
- 입력: 시장 데이터 + 최신 뉴스 20건
- LLM 프롬프트 핵심 지시: *"단기 상승 가능성이 높은 KR 종목 3개 추천"*
- 출력: 종목코드, 종목명, 추천 이유, 확신도(1~10)

#### 매수 필터 (AND 조건)

| 조건 | 기준 |
|------|------|
| 현재가 | `current_price > 0` (시세 조회 성공) |
| 수량 | `qty >= 1` (예산 ÷ 현재가 ≥ 1주) |

#### 예산 계산

```
예산 = 총 예수금(dnca_tot_amt) × 50% ÷ 3
최소 예산 = 100,000원 (잔고 조회 실패 시에도 동일)
```

- 주문 방식: **시장가** (`price=0`)
- 최대 종목 수: **3개**

---

### 2-B. 저녁 루틴 (미국장)

**파일**: `src/scheduler/routines.py` → `run_evening_routine()`  
**실행 시각**: 22:00 루틴 실행 → **23:30 매수 주문**

#### 추천 생성

- `get_daily_recommendations(None, news_data, market="US")`
- 입력: 뉴스 20건 (시장 데이터 없음)
- LLM 프롬프트 핵심 지시: *"단기 상승 가능성이 높은 US 종목 3개 추천"*

#### 매수 필터 (AND 조건)

| 조건 | 기준 |
|------|------|
| 현재가 | `current_price > 0` |
| 수량 | `qty >= 1` (`$500 / 현재가 ≥ 1주`) |

#### 예산 계산

```
예산 = 종목당 고정 $500
```

- 주문 방식: **지정가** (LLM 추천 시점 현재가 기준)
- 거래소: 종목 검색 결과 기반 자동 결정 (기본값 NAS)
- 최대 종목 수: **3개**

---

### 2-C. 일일 작업 기반 매수 (DailyTradingJob)

**파일**: `src/scheduler/daily_job.py` + `src/analysis/llm_analyzer.py`  
**함수**: `analyze_for_buy()`

#### 확신도 기반 매수 금액 조정

| 확신도 (confidence) | 매수 금액 |
|---------------------|-----------|
| 9 ~ 10 | `max_buy_amount` (최대) |
| 7 ~ 8 | `default` ~ `max` 사이 선형 비례 |
| 5 ~ 6 | `buy_amount_per_stock` (기본) |
| 3 ~ 4 | `min_buy` ~ `default` 사이 선형 비례 |
| 1 ~ 2 | `min_buy_amount` (최소) |

- 금액 기준값은 `RISK_CONFIG`에서 관리 (`src/utils/config.py`)
- 하루 최대 매수 종목 수: `RISK_CONFIG["max_buy_per_day"]`

---

## 전략 비교 요약

| 항목 | 모멘텀 단타 (알고리즘) | 일일 추천 (LLM) |
|------|----------------------|----------------|
| 판단 주체 | 규칙 기반 알고리즘 | OpenAI LLM |
| 신호 소스 | KIS 급등 랭킹 API | 뉴스 + 시장 데이터 |
| 매수 시점 | 장중 실시간 | 예약 (09:00 / 23:30) |
| 보유 기간 | 당일 청산 (데이트레이딩) | 중기 보유 가정 |
| 매도 기준 | 장 마감 전 무조건 청산 | 수익률 +5% / -3% 초과 시 |
| 주문 방식 | 시장가 | KR 시장가 / US 지정가 |
